name: Build package

on:
  workflow_dispatch:
    inputs:
      package:
        description: The name of the package to build.
        required: true

jobs:
  build_package:
    name: Build package ${{github.event.inputs.package}}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Start docker container
        id: container
        run: docker run -d -name build --rm -it -v (pwd):/build --name arch archlinux:base-devel cat

      - name: Setting up container
        run: |
          docker exec -i build pacman -Syu --noconfirm git namcap sudo \
          && docker exec -i build pacman -Syu --noconfirm "echo ALL ALL=NOPASSWD: /usr/bin/pacman > /etc/sudoers.d/pacman"

      - name: Building package
        run: |
          docker exec -i -w /build/${{github.event.inputs.package}} build makepkg -s --noconfirm -f
